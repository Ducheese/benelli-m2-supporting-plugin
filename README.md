### 一、插件介绍

实现管式弹仓供弹霰弹枪（*Tube-Fed Shotgun*）的战术上弹动作。具体特性如下：

1. 打空子弹后，自动触发一整套新的上弹动作。这套动作分为如下四段：

    | 对应.qc中的序列名      | 目前在.sp中的体现     | 含义和上下关系                                               | 播放次数                      |
    | ---------------------- | --------------------- | ------------------------------------------------------------ | ----------------------------- |
    | ``reload_start_empty`` | ``ANIM_RLDE_START``   | 1. 整套动作的起始，可以是很短的抬手动作，下接``reload_chamber``<br />2. 该段动作结束的瞬间，子弹数便会更新，表示弹膛+1 | 必定有1次                     |
    | ``reload_chamber``     | ``ANIM_RLDE_CHAMBER`` | 1. 把单发子弹直接塞进膛内的动作（老外的叫法是*Ghost Loading*），也是本插件**要的那叠醋**<br />2. 该段动作结束的时候，如果备弹有余，则子弹数便会更新，下接``reload_loop_empty``。反之，子弹数不变，下接``reload_end_empty``<br />3. 该段动作结束之后，是可以立即开火、打断上弹过程的 | 必定有1次                     |
    | ``reload_loop_empty``  | ``ANIM_RLDE_LOOP``    | 1. 反复往弹仓塞子弹的动作，动作本身得是**首尾相接**的<br />2. 同上。该段动作结束的时候，如果备弹有余，则子弹数便会更新，下接``reload_loop_empty``。反之，子弹数不变，下接``reload_end_empty`` | 最少0次，最大看备弹和弹仓容量 |
    | ``reload_end_empty``   | ``ANIM_RLDE_END``     | 上接``reload_chamber``或``reload_end_empty``，下接``idle``   | 必定有1次                     |

    不难发现，子弹数（*clip*）更新是**先于**所对应的上弹动作的，我个人觉得这个节奏是比较舒服的。

    插件内部，接连播放每段动作的逻辑是**计时执行**。并且，为达成动作的连贯性，每段动作很大概率不是完整播放，而是**缩短**计时、去掉一点尾巴。

    嗯，虽然每段动作的界限描述变得很模糊，但如果动作结尾时，主要活动的**手正好运动到视野之外**，那么衔接就有很多容错空间了。

2. 突破原版引擎限制，可以自由设置武器脚本的弹仓容量（*clipsize*）。所谓引擎限制总结如下表：

    | 规则 | 三值关系可能性                                             | 说明                                                         | 短按R的效果                                                  | 长按R的效果                                                  |
    | ---- | ---------------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
    | 1    | 当前*clip* < 实际*clipsize* = 默认*clipsize*               | 即不修改武器脚本，最为原始且常见的换弹情形                   | 当前*clip* = 两个*clipsize*时会停止上弹                      | 基本同短按，但如果不松手，不会播放``reload_end``动作         |
    | 2    | 当前*clip* < 实际*clipsize* < 默认*clipsize*               | 修改了武器脚本，往小了改                                     | 当前*clip* = **实际*clipsize***时会停止上弹，但不会播放``reload_end``动作 | 无特别效果                                                   |
    | 3    | 当前*clip* < 默认*clipsize* < 实际*clipsize*               | 修改了武器脚本，往大了改                                     | 当前*clip* = **默认*clipsize***时会停止上弹，有``reload_end``动作 | 可以**突破默认*clipsize***，增加到实际*clipsize*，但无论松不松手，都不会播放``reload_end``动作 |
    |      |                                                            |                                                              |                                                              |                                                              |
    | 4    | 当前*clip* > 实际*clipsize*                                | 可能是通过某插件强行修改当前*clip*的值，此时默认*clipsize*在哪并不重要 | 将无视两个*clipsize*反复上弹，当前*clip*不断增加，直至耗完所有备弹 | 无特别效果                                                   |
    |      |                                                            |                                                              |                                                              |                                                              |
    | 5    | 当前*clip* = 实际*clipsize* ? 默认*clipsize*<br />?表示><= | 满弹情形，无论怎样都无法触发换弹，此时两个*clipsize*的大小关系并不重要 | 无效                                                         | 无效                                                         |
    |      |                                                            |                                                              |                                                              |                                                              |
    | 6    | 实际*clipsize* > 当前*clip* > 默认*clipsize*               | 修改了武器脚本，往大了改                                     | 当前*clip* = **实际*clipsize***时会停止上弹，但不会播放``reload_end``动作 | 无特别效果                                                   |
    | 7    | 当前*clip* = 默认*clipsize* < 实际*clipsize*               | 修改了武器脚本，往大了改                                     | 只能重复播放``reload_start``和``reload_end``，当前*clip*不会增加 | 可以**突破默认*clipsize***，增加到实际*clipsize*，无论松不松手，都不会播放``reload_end``动作 |

    以示例模型Agency Arms Benelli M2为例，其实际*clipsize*为8（参考现实信息），替换的是xm1014，因此默认*clipsize*为7。

    当前*clip*小于7时，受规则3和7限制，无法上弹到8。通过战术换弹强制修改当前*clip*为8+1=9时，受规则4影响，会耗完所有备弹。当前*clip*为8时，受规则5限制，无法主动触发换弹。这些问题要一一解决。

### 二、待完成事项

1. 将动作序列号、帧数长度、计时执行等参数，扩展为外置配置文件，方便支持更多模型（如老杰西的RON喷子）

2. 增加对机瞄和侧瞄插件的支持（没有考虑备用v模，应该可以参考快速近战插件修改）